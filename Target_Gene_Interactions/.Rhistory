ls()
ls
ls()
setwd("~/MRC_BSU_Internship/Target_Gene_Interactions")
ls()
dir()
?file
?data.table::fread
source('~/MRC_BSU_Internship/Target_Gene_Interactions/LoadBgen.R', echo=TRUE)
test <- FindAllRSIds('/mrc-bsu/scratch/zmx21/UKB_Data/','ukb_imp_chr10_HRConly')
head(test)
tail(test)
length(unqiue(test$rsid))
length(unique(test$rsid))
test2 <- dplyr::filter(rsid!='rs9663334')
test2 <- dplyr::filter(test,rsid!='rs9663334')
test <- FindAllRSIds('/mrc-bsu/scratch/zmx21/UKB_Data/','ukb_imp_chr10_HRConly')
allRSIds <- data.frame(rsid=unique(test$rsid))
allRSIds <- unique(test$rsid)
allRSIds <- unique(test$rsid)
?split
allRSIds <- unique(test$rsid)
rsIDChunks <- split(allRSIds,seq(length(rsid)-1)%/%chunkSize)
rsIDChunks <- split(allRSIds,seq(length(allRSIds)-1)%/%chunkSize)
chunkSize=50
rsIDChunks <- split(allRSIds,seq(length(allRSIds)-1)%/%chunkSize)
rsIDChunks
rsIDChunks <- split(allRSIds,seq(length(allRSIds)-1)%/%chunkSize)
rsIDChunks <- split(allRSIds,seq(length(allRSIds)-1)%/%chunkSize)[[1]]
rsIDChunks
?rbgen::bgen.load
rsIDChunks <- split(allRSIds,seq(length(allRSIds)-1)%/%chunkSize)
rsIDChunks[[1]]
rsIDChunks[1]
rsIDChunks[[1]]
source('~/MRC_BSU_Internship/Target_Gene_Interactions/GxG_Interactions.R', echo=TRUE)
debugSource('~/MRC_BSU_Internship/Target_Gene_Interactions/LoadBgen.R', echo=TRUE)
source('~/MRC_BSU_Internship/Target_Gene_Interactions/GxG_Interactions.R', echo=TRUE)
setwd("~/MRC_BSU_Internship/Target_Gene_Interactions")
source('~/MRC_BSU_Internship/Target_Gene_Interactions/GxG_Interactions.R', echo=TRUE)
#Genotype info of target gene
target_file_prefix <- gsub(pattern = '#',replacement = target_chr,x = bgen_file_prefix)
dosageTarget <- LoadBgen(path,target_file_prefix,data.frame(rsid=targetRS))
dosageTarget <- dosageTarget$data
dosageTarget <- matrix(0,nrow = nrow(dosageTarget),ncol = ncol(dosageTarget)) + dosageTarget[,,'g=1'] + 2*dosageTarget[,,'g=2']
#Genotype info of target gene
target_file_prefix <- gsub(pattern = '#',replacement = target_chr,x = bgen_file_prefix)
dosageTarget <- LoadBgen(path,target_file_prefix,data.frame(rsid=targetRS))
targetRS
dosageTarget <- LoadBgen(path,target_file_prefix,targetRS)
genotype_data <- LoadBgen(path,bgen_file_prefix,rsIDChunks[[1]])
#supply default values
# path <-  '~/rds/hpc-work/UKB_Data/'
# sample_file_prefix <- 'ukbb_eur_all_sbp'
# bgen_file_prefix <- 'ukb_imp_chr#_HRConly'
# chr <- '10'
# phenotype = 'sbp'
# targetRS <- 'rs603424'
# target_chr <- '10'
# path_out <- paste0(path,targetRS,'_',phenotype)
# n_cores=2
path <-  '/mrc-bsu/scratch/zmx21/UKB_Data/'
bgen_file_prefix <- 'ukb_imp_chr10_HRConly'
genotype_data <- LoadBgen(path,bgen_file_prefix,rsIDChunks[[1]])
chunkSize=100
allRSIds <- FindAllRSIds(path,bgen_file_prefix) %>% dplyr::filter(rsid!=targetRS)
allRSIds <- unique(allRSIds$rsid)
rsIDChunks <- split(allRSIds,seq(length(allRSIds)-1)%/%chunkSize)
allRSIds <- FindAllRSIds(path,bgen_file_prefix) %>% dplyr::filter(rsid!=targetRS)
genotype_data <- LoadBgen(path,bgen_file_prefix,rsIDChunks[[1]])
setwd("~/MRC_BSU_Internship/Target_Gene_Interactions")
library(dplyr)
library(biomaRt)
#Load interaction results
chr <- 10
path <- '~/bsu_scratch/UKB_Data/rs603424_sbp/'
interactionResults <- data.table::fread(paste0(path,'chr',chr,'.txt'))
colnames(interactionResults) <- c('rsid','p','coeff')
SNPdb <- data.table::fread(paste0('~/bsu_scratch/All_VCF/chr',chr,'.vcf'))
interactionResults <- dplyr::left_join(interactionResults,SNPdb,by=c('rsid'='ID'))
interactionResults <- data.table::fread(paste0(path,'chr',chr,'.txt'))
colnames(interactionResults) <- c('rsid','p','coeff')
interactionResults <- dplyr::left_join(interactionResults,SNPdb,by=c('rsid'='ID'))
interactionResults$POS
interactionResults$rsid
sum(is.na(interactionResults$POS))
library(dplyr)
chr <- 10
print(chr)
path <- '~/bsu_scratch/UKB_Data/rs603424_sbp/'
interactionResults <- data.table::fread(paste0(path,'chr',chr,'.txt'))
colnames(interactionResults) <- c('rsid','p','coeff')
SNPdb <- data.table::fread(paste0('~/bsu_scratch/All_VCF/ensembl/homo_sapiens-chr',chr,'.vcf'))
